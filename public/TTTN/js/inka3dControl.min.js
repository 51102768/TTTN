var inka3dControl=function(){"use strict";var control={};return control.cameraY=function(tx,ty,tz,rx,ry,rz,di,fr){var a=.5*rx,b=.5*ry,c=.5*rz,d=Math.cos(a),e=Math.sin(a),f=Math.cos(b),g=Math.sin(b),h=Math.cos(c),i=Math.sin(c),j=f*e*h+g*d*i,k=f*-e*i+g*d*h,l=f*d*i-g*e*h,m=f*d*h-g*-e*i,n=j*j,o=k*k,p=l*l,q=m*m,r=j*k,s=k*l,t=j*l,u=m*j,v=m*k,w=m*l,x=q+n-o-p,y=2*(r+w),z=2*(t-v),A=2*(r-w),B=q-n+o-p,C=2*(s+u),D=2*(t+v),E=2*(s-u),F=q-n-o+p,G=di,H=-(tx+D*G),I=-(ty+E*G),J=-(tz+F*G);fr[0]=x,fr[1]=A,fr[2]=D,fr[3]=0,fr[4]=y,fr[5]=B,fr[6]=E,fr[7]=0,fr[8]=z,fr[9]=C,fr[10]=F,fr[11]=0,fr[12]=x*H+y*I+z*J,fr[13]=A*H+B*I+C*J,fr[14]=D*H+E*I+F*J,fr[15]=1},control.cameraZ=function(tx,ty,tz,rx,ry,rz,di,fr){var a=.5*rx,b=.5*rz,c=.5*ry,d=Math.cos(a),e=Math.sin(a),f=Math.cos(b),g=Math.sin(b),h=Math.cos(c),i=Math.sin(c),j=h*e*f-i*d*g,k=h*d*g+i*e*f,l=h*e*g+i*d*f,m=h*d*f-i*e*g,n=.707107*m+.707107*j,o=.707107*k+.707107*l,p=.707107*l-.707107*k,q=.707107*m-.707107*j,r=n*n,s=o*o,t=p*p,u=q*q,v=n*o,w=o*p,x=n*p,y=q*n,z=q*o,A=q*p,B=u+r-s-t,C=2*(v+A),D=2*(x-z),E=2*(v-A),F=u-r+s-t,G=2*(w+y),H=2*(x+z),I=2*(w-y),J=u-r-s+t,K=di,L=-(tx+H*K),M=-(ty+I*K),N=-(tz+J*K);fr[0]=B,fr[1]=E,fr[2]=H,fr[3]=0,fr[4]=C,fr[5]=F,fr[6]=I,fr[7]=0,fr[8]=D,fr[9]=G,fr[10]=J,fr[11]=0,fr[12]=B*L+C*M+D*N,fr[13]=E*L+F*M+G*N,fr[14]=H*L+I*M+J*N,fr[15]=1},control.Input=function(canvas){function mouseDown(e){touching||(input.positionX=(e.pageX-canvas.offsetLeft+.5)/canvas.offsetWidth*2-1,input.positionY=(e.pageY-canvas.offsetTop+.5)/canvas.offsetHeight*-2+1,input.pressed=!0,mousePressed=!0,input.moveStart(0,0))}function mouseUp(){mousePressed&&(input.pressed=!1,mousePressed=!1,input.moveEnd(0,0))}function mouseMove(e){if(!touching){var x=(e.pageX-canvas.offsetLeft+.5)/canvas.offsetWidth*2-1,y=(e.pageY-canvas.offsetTop+.5)/canvas.offsetHeight*-2+1,dx=x-input.positionX,dy=y-input.positionY;input.positionX=x,input.positionY=y,mousePressed?input.move(dx,dy):input.hover(dx,dy)}return!0}function mouseWheel(e){var dy=e.wheelDelta?e.wheelDelta/120:e.detail?e.detail/-3:0;return input.scroll(0,dy),e.preventDefault(),!0}function touchChange(e){if(touching=e.touches.length>0){var t0=e.touches[0];input.positionX=(t0.pageX-canvas.offsetLeft+.5)/canvas.offsetWidth*2-1,input.positionY=(t0.pageY-canvas.offsetTop+.5)/canvas.offsetHeight*-2+1,input.pressed=!0,input.moveStart(0,0)}else input.moveEnd(0,0),input.positionValid=!1;if(2==e.touches.length){var t0=e.touches[0],t1=e.touches[1],x=t1.pageX-t0.pageX,y=t1.pageY-t0.pageY;touchScale=Math.sqrt(x*x+y*y)}}function touchMove(e){if(e.touches.length>0){var t0=e.touches[0],x=(t0.pageX-canvas.offsetLeft+.5)/canvas.offsetWidth*2-1,y=(t0.pageY-canvas.offsetTop+.5)/canvas.offsetHeight*-2+1,dx=x-input.positionX,dy=y-input.positionY;input.positionX=x,input.positionY=y,input.move(dx,dy)}if(2==e.touches.length){var t0=e.touches[0],t1=e.touches[1],x=t1.pageX-t0.pageX,y=t1.pageY-t0.pageY,s=Math.sqrt(x*x+y*y);input.zoomRotate(s/touchScale,0),touchScale=s}return!1}this.positionX=0,this.positionY=0,this.pressed=!1,this.hover=function(){},this.moveStart=function(){},this.moveEnd=function(){},this.move=function(){},this.scroll=function(){},this.zoomRotate=function(){};var input=this,mousePressed=!1,touching=!1,touchScale=1;canvas.onmousedown=mouseDown,canvas.onmouseup=mouseUp,canvas.onselectstart=function(){return!1},canvas.onmousemove=mouseMove,canvas.addEventListener&&canvas.addEventListener("DOMMouseScroll",mouseWheel,!1),canvas.onmousewheel=mouseWheel,canvas.ontouchend=canvas.ontouchstart=touchChange,canvas.ontouchmove=touchMove},control}();
var inka3dEngine=function(){"use strict";var engine={};engine.trunc=function(x){return x-x%1},engine.matrix4x4Mul=function(fa,fb,fr){var a=fa[0],b=fa[1],c=fa[2],d=fa[3],e=fb[0],f=fb[1],g=fb[2],h=fb[3],i=fa[4],j=fa[5],k=fa[6],l=fa[7],m=fa[8],n=fa[9],o=fa[10],p=fa[11],q=fa[12],r=fa[13],s=fa[14],t=fa[15],u=fb[4],v=fb[5],w=fb[6],x=fb[7],y=fb[8],z=fb[9],A=fb[10],B=fb[11],C=fb[12],D=fb[13],E=fb[14],F=fb[15];fr[0]=a*e+i*f+m*g+q*h,fr[1]=b*e+j*f+n*g+r*h,fr[2]=c*e+k*f+o*g+s*h,fr[3]=d*e+l*f+p*g+t*h,fr[4]=a*u+i*v+m*w+q*x,fr[5]=b*u+j*v+n*w+r*x,fr[6]=c*u+k*v+o*w+s*x,fr[7]=d*u+l*v+p*w+t*x,fr[8]=a*y+i*z+m*A+q*B,fr[9]=b*y+j*z+n*A+r*B,fr[10]=c*y+k*z+o*A+s*B,fr[11]=d*y+l*z+p*A+t*B,fr[12]=a*C+i*D+m*E+q*F,fr[13]=b*C+j*D+n*E+r*F,fr[14]=c*C+k*D+o*E+s*F,fr[15]=d*C+l*D+p*E+t*F},engine.matrix4x4Inv=function(fa,fr){var a=fa[4],b=fa[5],c=fa[6],d=fa[7],e=fa[8],f=fa[9],g=fa[10],h=fa[11],i=fa[12],j=fa[13],k=fa[14],l=fa[15],m=e*l-h*i,n=f*l-h*j,o=g*l-h*k,p=e*k-g*i,q=f*i-e*j,r=g*j-f*k,s=b*o-c*n-d*r,t=c*m-d*p-a*o,u=q*-d+a*n-b*m,v=a*r+b*p+c*q,w=fa[0],x=fa[1],y=fa[2],z=fa[3],A=i*z-l*w,B=j*z-l*x,C=k*z-l*y,D=i*y-k*w,E=j*w-i*x,F=k*x-j*y,G=w*d-z*a,H=x*d-z*b,I=y*d-z*c,J=w*c-y*a,K=x*a-w*b,L=y*b-x*c,M=a*h-d*e,N=b*h-d*f,O=c*h-d*g,P=a*g-c*e,Q=b*e-a*f,R=c*f-b*g,S=1/(w*s+x*t+y*u+z*v);fr[0]=S*s,fr[1]=S*-(f*C-g*B-h*F),fr[2]=S*(j*I-k*H-l*L),fr[3]=S*-(x*O-y*N-z*R),fr[4]=S*t,fr[5]=S*-(g*A-h*D-e*C),fr[6]=S*(k*G-l*J-i*I),fr[7]=S*-(y*M-z*P-w*O),fr[8]=S*u,fr[9]=S*-(E*-h+e*B-f*A),fr[10]=S*(K*-l+i*H-j*G),fr[11]=S*-(Q*-z+w*N-x*M),fr[12]=S*v,fr[13]=S*-(e*F+f*D+g*E),fr[14]=S*(i*L+j*J+k*K),fr[15]=S*-(w*R+x*P+y*Q)},engine.matrix4x4Projection=function(fp,aspect,fr){var e,a=fp[2],b=fp[3],c=fp[0],d=c*c;if(2>d)e=aspect*b>a;else{var f;if(5>d)f=-1;else{var g;g=10>d?0:a>aspect*b,f=g}e=f}var h,i;0!=e?(h=a,i=a/aspect):(h=b*aspect,i=b);var m,n,o,p,q,r,s,t,j=2*fp[1],k=2*fp[4]/h,l=2*fp[5]/i;if(0>c){var u=fp[6],v=fp[7],w=1/(u-v);m=0,n=0,o=2*w,p=0,q=k,r=l,s=(v+u)*w,t=1}else{var x=fp[6],y=fp[7],z=1/(x-y);m=k,n=l,o=(y+x)*z,p=-1,q=0,r=0,s=2*y*x*z,t=0}fr[0]=j/h,fr[1]=0,fr[2]=0,fr[3]=0,fr[4]=0,fr[5]=j/i,fr[6]=0,fr[7]=0,fr[8]=m,fr[9]=n,fr[10]=o,fr[11]=p,fr[12]=q,fr[13]=r,fr[14]=s,fr[15]=t},engine.Renderer=function(numRenderJobs){for(var begin={p:null,n:null,next:null,render:null,draw:null,instance:null,data:new Float32Array(18)},end=begin,n=numRenderJobs+1;n>1;){var rj={p:end,n:null,next:null,render:null,draw:null,instance:null,data:new Float32Array(18)};end.n=rj,end=rj,--n}this.iBegin=begin,this.iEnd=end,this.iResetShader=function(){},this.begin=null,this.end=null,this.alphaSort=null,this.pickFBO=null,this.pickProjectionMatrix=new Float32Array(16),this.pickPixel=new Uint8Array(4),this.nextId=1,this.idPool=[];var renderer=this;renderer.createGroup=function(){var group={renderer:renderer,scenes:[]};return group.update=function(){var i,scenes=group.scenes;for(i=0;i<scenes.length;++i)scenes[i].update()},group.render=function(viewMatrix,projectionMatrix,layerName){var rq=renderer;rq.begin=rq.iBegin,rq.end=rq.iEnd,rq.alphaSort=null,gl.enableVertexAttribArray(0),gl.enableVertexAttribArray(1);for(var scenes=group.scenes,i=0;i<scenes.length;++i)scenes[i].render(viewMatrix,projectionMatrix,layerName,rq);null!=rq.alphaSort&&(gl.depthMask(!1),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA),renderSorted(rq.alphaSort),gl.blendFunc(gl.ONE,gl.ZERO),gl.disable(gl.BLEND),gl.depthMask(!0)),gl.bindBuffer(gl.ARRAY_BUFFER,null),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null),gl.disable(gl.CULL_FACE),gl.cullFace(gl.BACK),gl.useProgram(null),gl.disableVertexAttribArray(1),gl.disableVertexAttribArray(0)},group.pick=function(viewMatrix,projectionMatrix,x,y){var viewport=gl.getParameter(gl.VIEWPORT),clearColor=gl.getParameter(gl.COLOR_CLEAR_VALUE),fp=projectionMatrix,fr=renderer.pickProjectionMatrix,a=-1e4*x,b=-1e4*y,c=fp[3],d=fp[7],e=fp[11],f=fp[15];fr[0]=1e4*fp[0]+a*c,fr[1]=1e4*fp[1]+b*c,fr[2]=fp[2],fr[3]=c,fr[4]=1e4*fp[4]+a*d,fr[5]=1e4*fp[5]+b*d,fr[6]=fp[6],fr[7]=d,fr[8]=1e4*fp[8]+a*e,fr[9]=1e4*fp[9]+b*e,fr[10]=fp[10],fr[11]=e,fr[12]=1e4*fp[12]+a*f,fr[13]=1e4*fp[13]+b*f,fr[14]=fp[14],fr[15]=f,renderer.pickFBO||(renderer.pickFBO=createPickBuffer())||alert("could not create frame buffer for picking"),gl.bindFramebuffer(gl.FRAMEBUFFER,renderer.pickFBO),gl.viewport(0,0,1,1),gl.clearColor(0,0,0,1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),group.render(viewMatrix,fr,"pick");var pixel=renderer.pickPixel;return gl.readPixels(0,0,1,1,gl.RGBA,gl.UNSIGNED_BYTE,pixel),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(viewport[0],viewport[1],viewport[2],viewport[3]),gl.clearColor(clearColor[0],clearColor[1],clearColor[2],clearColor[3]),(pixel[0]>>3)+32*(pixel[1]>>2)+2048*(pixel[2]>>3)},group}},engine.loadEmbedded=function(container,url,name,textureSetIndex,onload){var loader={status:0,onload:onload,onprogress:function(){},progress:0,numFiles:container.numFiles,numLoaded:0};return load(container,url,name,textureSetIndex,loader),loader},engine.loadJSON=function(url,name,textureSetIndex,onload){var loader={status:0,onload:onload,onprogress:function(){},progress:0,numFiles:1,numLoaded:0},xhr=new XMLHttpRequest;return xhr.open("GET",url+name+".json",!0),xhr.onload=function(event){if(200!=this.status&&0!=this.status)loader.status=this.status,loader.onload(null);else{var container=JSON.parse(this.response),n=loader.numFiles=1+container.numFiles;loader.onprogress(loader.progress=++loader.numLoaded/n);var textures=container.textures;for(var name in textures){var texture=textures[name];texture.initGlobal=eval(texture.initGlobal),texture.doneGlobal=eval(texture.doneGlobal),texture.copy=eval(texture.copy)}var scenes=container.scenes;for(var name in scenes){var scene=scenes[name],shaders=scene.shaders;scene.initGlobal=eval(scene.initGlobal),scene.doneGlobal=eval(scene.doneGlobal);var render=scene.render;for(var r in render)render[r]=eval(render[r]);var draw=scene.draw;for(var d in draw)draw[d]=eval(draw[d]);scene.createInstance=eval(scene.createInstance),scene.doneInstance=eval(scene.doneInstance)}container.check=eval(container.check),load(container,url,name,textureSetIndex,loader)}},xhr.send(),loader},engine.noise=function(x,y,z){var l=arguments.length;return 1==l?engine.noise2f(x,0):2==l?engine.noise2f(x,y):3==l?engine.noise3f(x,y,z):void 0};var load=function(container,url,name,textureSetIndex,loader){var dataUrl=url+name+".dat",s=container.check();if(0!=s)return loader.status=s,loader.onload(null),void 0;container.instances=[],container.done=function(){for(var i=0;i<container.instances.length;++i)conntainer.instances[i].done();for(var name in container.textures)textures[name].doneGlobal(textures[name]);for(var name in container.scenes)scenes[name].doneGlobal(scenes[name])},container.createScene=function(name,group){for(var scene=container.scenes[name],instance=scene.createInstance(scene,group.renderer),textures=container.textures,tb=scene.textureBindings,i=0;i<tb.length;++i){var texture=textures[tb[i].n];texture.copy(texture,instance.ostate,tb[i].b)}return instance.inGroup=group.scenes.length,group.scenes.push(instance),instance.inContainer=container.instances.length,container.instances.push(instance),instance.getAttributes=function(){return scene.attributes},instance.getIntVector=function(name,length){var a=scene.attributes[name];return instance.istate.subarray(a.b,a.e)},instance.getIntArray=function(name){var a=scene.attributes[name];return instance.istate.subarray(a.b,a.e)},instance.getFloatVector=function(name,length){var a=scene.attributes[name];return instance.fstate.subarray(a.b,a.e)},instance.getFloatArray=function(name){var a=scene.attributes[name];return instance.fstate.subarray(a.b,a.e)},instance.getTexture=function(name,index){var a=scene.attributes[name],i=index||0;return instance.ostate[a.b+i]},instance.setTexture=function(name,texture,index){var a=scene.attributes[name],i=index||0;instance.ostate[a.b+i]=texture},instance.getObjectId=function(name){var index=scene.objects[name];return null==index?-1:(0==instance.ids[index]&&(instance.ids[index]=group.renderer.idPool.length>0?group.renderer.idPool.pop():group.renderer.nextId++),instance.ids[index])},instance.done=function(){var index=instance.inGroup,scenes=group.scenes;scenes.splice(index,1);for(var i=0;i<scenes.length;++i)scenes[i].inGroup>index&&--scenes[i].inGroup;index=instance.inContainer,scenes=container.instances,scenes.splice(index,1);for(var i=0;i<scenes.length;++i)scenes[i].inContainer>index&&--scenes[i].inContainer;for(var i=0;i<instance.ids.length;++i)0!=instance.ids[i]&&group.renderer.idPool.push(instance.ids[i]);scene.doneInstance(instance)},instance};var loaded=function(){var n=loader.numFiles;loader.onprogress(loader.progress=++loader.numLoaded/n),loader.numLoaded==n&&loader.onload(container)},textures=container.textures;for(var name in textures)textures[name].initGlobal(textures[name],url,textureSetIndex,loaded);var xhr=new XMLHttpRequest;xhr.open("GET",dataUrl,!0),xhr.responseType="arraybuffer",xhr.onload=function(){if(200!=this.status&&0!=this.status)loader.status=this.status,loader.onload(null);else{var scenes=container.scenes;for(var name in scenes)scenes[name].initGlobal(scenes[name],this.response);gl.bindBuffer(gl.ARRAY_BUFFER,null),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null),gl.useProgram(null),loaded()}},xhr.send()},createPickBuffer=function(){var buffer0=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,buffer0),gl.renderbufferStorage(gl.RENDERBUFFER,gl.RGB565,1,1);var buffer1=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,buffer1),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,1,1),gl.bindRenderbuffer(gl.RENDERBUFFER,null);var fbo=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,fbo),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,buffer0),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,buffer1);var status=gl.checkFramebufferStatus(gl.FRAMEBUFFER);return gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.deleteRenderbuffer(buffer0),gl.deleteRenderbuffer(buffer1),status==gl.FRAMEBUFFER_COMPLETE?fbo:(gl.deleteFramebuffer(fbo),null)};engine.createVertexShader=function(code,name){var shader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(shader,code),gl.compileShader(shader);return shader},engine.createPixelShader=function(code,name){var shader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(shader,code),gl.compileShader(shader);return shader};var renderSorted=function(list){for(var insize=1;;){var p=list;list=null;for(var tail=null,nmerges=0;null!=p;){nmerges++;var i,q=p,psize=0;for(i=0;insize>i&&(psize++,q=q.next,null!=q);i++);for(var e,qsize=insize;psize>0||qsize>0&&null!=q;)0==psize?(e=q,q=q.next,qsize--):0==qsize||null==q?(e=p,p=p.next,psize--):p.data[16]>q.data[16]?(e=p,p=p.next,psize--):(e=q,q=q.next,qsize--),null!=tail?tail.next=e:list=e,tail=e;p=q}if(tail.next=null,1>=nmerges)break;insize*=2}for(;null!=list;)list.render(list),list=list.next};engine.eST=function(xValues,yValues,numKeys,x){for(var low=0,high=numKeys,a=low+high>>1;high-1>low;)xValues[a]>x?high=a:low=a,a=low+high>>1;return yValues[a]},engine.eBT=function(xValues,yValues,numKeys,x){for(var low=0,high=numKeys-1,a=low+high>>1;high-1>low;)xValues[a]>x?high=a:low=a,a=low+high>>1;var b=xValues[a],c=3*a,d=(x-b)/(xValues[a+1]-b),e=d*d,f=e*d;return(-1*f+3*e+-3*d+1)*yValues[c]+(3*f+-6*e+3*d)*yValues[c+1]+(-3*f+3*e)*yValues[c+2]+f*yValues[c+3]},engine.eWBT=function(xValues,yValues,numKeys,x){for(var low=0,high=numKeys-1,a=low+high>>1;high-1>low;)xValues[3*a]>x?high=a:low=a,a=low+high>>1;var b=3*a,c=xValues[b],d=xValues[b+3],e=b,f=xValues[b+1],g=xValues[b+2],h=(x-c)/(d-c),i=-3*c+3*f,j=3*c+-6*f+3*g,k=-1*c+3*f+-3*g+d,l=h*h,m=h-(l*h*k+l*j+h*i+c-x)/(3*l*k+2*h*j+i),n=m*m,o=m-(n*m*k+n*j+m*i+c-x)/(3*n*k+2*m*j+i),p=o*o,q=o-(p*o*k+p*j+o*i+c-x)/(3*p*k+2*o*j+i),r=q*q,s=r*q;return(-1*s+3*r+-3*q+1)*yValues[e]+(3*s+-6*r+3*q)*yValues[e+1]+(-3*s+3*r)*yValues[e+2]+s*yValues[e+3]},engine.eCT=function(yValues,x){var a=x,b=Math.floor(a),c=a-b,d=b,e=c*c,f=e*c;return.5*(yValues[d]*(2*e-f-c)+yValues[d+1]*(3*f-5*e+2)+yValues[d+2]*(-3*f+4*e+c)+yValues[d+3]*(f-e))};var perm=new Uint8Array([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),grad=new Float32Array([1,1,0,1,-1,1,0,1,1,-1,0,1,-1,-1,0,1,1,0,1,1,-1,0,1,1,1,0,-1,1,-1,0,-1,1,0,1,1,1,0,-1,1,1,0,1,-1,1,0,-1,-1,1,1,1,0,-1,-1,1,0,-1,1,-1,0,-1,-1,-1,0,-1,1,0,1,-1,-1,0,1,-1,1,0,-1,-1,-1,0,-1,-1,0,1,1,-1,0,-1,1,-1,0,1,-1,-1,0,-1,-1,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);return engine.noise2f=function(x,y){var i,j,a=x,b=y,c=.366*(a+b),d=Math.floor(a+c),e=Math.floor(b+c),f=.2113*(d+e),g=a-(d-f),h=b-(e-f);g>h?(i=1,j=0):(i=0,j=1);var k=g-i+.2113,l=h-j+.2113,m=g+-.5774,n=h+-.5774,o=255&d,p=255&e,q=perm[o+perm[p]]%12<<2,r=perm[o+i+perm[p+j]]%12<<2,s=perm[o+1+perm[p+1]]%12<<2,t=Math.max(.5-(g*g+h*h),0),u=Math.max(.5-(k*k+l*l),0),v=Math.max(.5-(m*m+n*n),0),w=t*t,x=u*u,y=v*v;return 70*(w*w*(grad[q]*g+grad[1|q]*h)+x*x*(grad[r]*k+grad[1|r]*l)+y*y*(grad[s]*m+grad[1|s]*n))},engine.noise3f=function(x,y,z){var l,m,n,o,p,q,a=x,b=y,c=z,d=.333333*(a+b+c),e=Math.floor(a+d),f=Math.floor(b+d),g=Math.floor(c+d),h=.166666*(e+f+g),i=a-(e-h),j=b-(f-h),k=c-(g-h);if(j>i){var r,s,t,u;if(k>j)r=0,s=1,t=0,u=1;else{var v,w;k>i?(v=0,w=1):(v=1,w=0),r=1,s=0,t=v,u=w}l=0,m=r,n=s,o=t,p=1,q=u}else{var x,y,z,A;if(k>j){var B,C;k>i?(B=0,C=1):(B=1,C=0),x=B,y=C,z=0,A=1}else x=1,y=0,z=1,A=0;l=x,m=0,n=y,o=1,p=z,q=A}var D=i-l+.166666,E=j-m+.166666,F=k-n+.166666,G=i-o+.333333,H=j-p+.333333,I=k-q+.333333,J=i+-.5,K=j+-.5,L=k+-.5,M=255&e,N=255&f,O=255&g,P=perm[M+perm[N+perm[O]]]%12<<2,Q=perm[M+l+perm[N+m+perm[O+n]]]%12<<2,R=perm[M+o+perm[N+p+perm[O+q]]]%12<<2,S=perm[M+1+perm[N+1+perm[O+1]]]%12<<2,T=Math.max(.6-(i*i+j*j+k*k),0),U=Math.max(.6-(D*D+E*E+F*F),0),V=Math.max(.6-(G*G+H*H+I*I),0),W=Math.max(.6-(J*J+K*K+L*L),0),X=T*T,Y=U*U,Z=V*V,ab=W*W;return 32*(X*X*(grad[P]*i+grad[1|P]*j+grad[2|P]*k)+Y*Y*(grad[Q]*D+grad[1|Q]*E+grad[2|Q]*F)+Z*Z*(grad[R]*G+grad[1|R]*H+grad[2|R]*I)+ab*ab*(grad[S]*J+grad[1|S]*K+grad[2|S]*L))},engine.Decompressor=function(compressed){this.compressed=compressed,this.index=4,this.range=4294967295,this.code=16777216*compressed[0]+65536*compressed[1]+256*compressed[2]+compressed[3],this.typeWeight=new Uint16Array(1),this.offsetWeights=new Uint16Array(64),this.lengthWeights=new Uint16Array(64),this.literalWeights=new Uint16Array(64),this.typeWeight[0]=2048;for(var i=0;64>i;++i)this.offsetWeights[i]=2048,this.lengthWeights[i]=2048,this.literalWeights[i]=2048;this.decompress8=function(size){var d=new Uint8Array(size);return this.decompress(d),d},this.decompress16=function(size){var d=new Uint16Array(size);return this.decompress(d),d},this.decompress32=function(size){var d=new Uint32Array(size);return this.decompress(d),d},this.decompress=function(data){for(var pos=0,size=data.length;size>pos;)if(0==this.readBitAndUpdateWeight(this.typeWeight,0))data[pos++]=this.readUniversalCode(this.literalWeights);else for(var offset=this.readUniversalCode(this.offsetWeights)+1,length=this.readUniversalCode(this.lengthWeights)+3,i=0;length>i;++i)data[pos]=data[pos-offset],++pos;var sum=0;for(pos=0;size>pos;++pos){var d=data[pos];sum=data[pos]=sum+(1&d?-(d>>>1)-1:d>>>1)}},this.readBitAndUpdateWeight=function(weight,i){for(;this.range<16777216;)this.code=256*this.code+this.compressed[this.index],this.range=256*this.range,++this.index;var threshold=(this.range>>>12)*weight[i];return this.code<threshold?(this.range=threshold,weight[i]+=4096-weight[i]>>4,0):(this.range-=threshold,this.code-=threshold,weight[i]-=weight[i]>>4,1)},this.readUniversalCode=function(weights){for(var numBits=0;1==this.readBitAndUpdateWeight(weights,numBits);)++numBits;if(!numBits)return 0;for(var value=1,i=numBits-2;i>=0;--i)value=value<<1|this.readBitAndUpdateWeight(weights,33+i);return value}},engine}();